<div class="container px-0">
  <div class="row">
    <div class="col-md-3">
      <%= render "shared/side", user:@user, book:Book.new %>
    </div>
    <div class="col-md-8 offset-md-1">
      <h2>Books</h2>
      <table class="table table-hover">
        <thead>
          <tr>
            <th></th>
            <th>Title</th>
            <th>Opinion</th>
            <th colspan="4"></th>
          </tr>
        </thead>
        <% @books.each do |book| %>
        <tbody>
          <tr>
            <td>
              <%= link_to user_path(book.user) do %>
                <%= attachment_image_tag book.user, :profile_image, :fill, 50, 50, fallback: "no-image-icon.jpg" %>
              <% end %>
            </td>
            <td>
              <%= link_to book_path(book) do %>
                <%= book.title %>
              <% end %>
              </td>
            <td><%= book.body %></td>
            <td class="favorite-btn<%= book.id %>">
              <%= render "favorites/favorite", book:book %>
            </td>
            <td>
              コメント数: <%= book.post_comments.count %>
            </td>
            <td>閲覧数: <%= book.book_count %></td>

            <td id="star_evaluation_<%= book.id %>"></td>
　　　　　　<script>
　　　　　　$('#star_evaluation_<%= book.id %>').empty();
            $('#star_evaluation_<%= book.id %>').raty({
              size     : 36,
              starOff:  '<%= asset_path('star-off.png') %>',
              starOn : '<%= asset_path('star-on.png') %>',
              starHalf: '<%= asset_path('star-half.png') %>',
              half: true,
              readOnly: true,
              score: <%= book.evaluation %>
            });
　　　　　　</script>

          </tr>
        </tbody>
        <% end %>
      </table>

      <h3>投稿数の前日比・前週比</h3>
      <table class="table table-bordered">
        <tr>
          <th>今日の投稿数</th>
          <th>前日の投稿数</th>
          <th>前日比</th>
        </tr>
        <tr>
          <td><%= @today_book %></td>
          <td><%= @yesterday_book %></td>
          <td><%= @user.ratio(@today_book,@yesterday_book) %></td>
        </tr>
      </table>
      <table class="table table-bordered">
        <tr>
          <th>今週の投稿数</th>
          <th>前週の投稿数</th>
          <th>前週比</th>
        </tr>
        <tr>
          <td><%= @this_week %></td>
          <td><%= @last_week %></td>
          <td><%= @user.ratio(@this_week,@last_week) %></td>
        </tr>
      </table>
      <table class="table table-bordered">
        <tr>
          <th>6日前</th><th>5日前</th><th>4日前</th><th>3日前</th><th>2日前</th><th>1日前</th><th>今日</th>
        </tr>
        <tr>
          <td><%= @user.week_date(6) %></td>
          <td><%= @user.week_date(5) %></td>
          <td><%= @user.week_date(4) %></td>
          <td><%= @user.week_date(3) %></td>
          <td><%= @user.week_date(2) %></td>
          <td><%= @user.week_date(1) %></td>
          <td><%= @user.week_date(0) %></td>
        </tr>
      </table>

      <canvas id="myChart"></canvas>
      <script>
      var ctx = document.getElementById("myChart");
      var myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ["6日前", "5日前", "4日前", "3日前", "2日前", "1日前", "今日"],
          datasets: [{
            label: '投稿した本の数',
            backgroundColor: "rgba(0,0,0,0)",
            borderColor: "green",
            data: [
              <%= @user.week_date(6) %>, <%= @user.week_date(5) %>, <%= @user.week_date(4) %>, <%= @user.week_date(3) %>,
              <%= @user.week_date(2) %>, <%= @user.week_date(1) %>, <%= @user.week_date(0) %>
            ]
          }]
        }
      });
      </script>
      <div>
        <%= form_with url: search_user_path(@user), local:false do |f| %>
          <%= f.date_field :content, id:"inputDate" %>
          <%= f.submit '検索', id:"button1", class:"btn btn-primary" %>
        <% end %>
      </div>

      <!--<script>-->
      <!--  $(document).ready(function() {-->
      <!--    $('#button1').on("click",function(){-->
      <!--      $('.books_count').removeClass('d-none');-->
      <!--    });-->
      <!--  });-->
      <!--</script>-->

      <div class="books_count">
        <% if @books_count.present? %>
          <%= render "books_count", books_count: @books_count %>
        <% end %>
      </div>

    </div>
  </div>
</div>